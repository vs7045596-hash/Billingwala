<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate FreeShop Billing App - Advanced POS System</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- AOS Animations -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { primary: { 50: '#ecfdf5', 500: '#10b981', 900: '#065f46' } } } }
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-all duration-300">
    <!-- Sidebar Navigation -->
    <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
        <div class="flex items-center justify-center h-16 px-4 border-b border-gray-200 dark:border-gray-700">
            <h1 class="text-xl font-bold text-primary-500">Ultimate FreeShop</h1>
        </div>
        <nav class="mt-5 px-2 space-y-1 max-h-screen overflow-y-auto">
            <a href="#" onclick="showSection('login'); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-500 transition-all duration-200" data-aos="fade-right">
                <span class="mr-4 h-6 w-6">📱</span> Login
            </a>
            <a href="#" onclick="showSection('adminLogin'); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-500 transition-all duration-200" data-aos="fade-right" data-aos-delay="50">
                <span class="mr-4 h-6 w-6">🔐</span> Admin Login
            </a>
            <a href="#" onclick="showSection('admin'); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-500 transition-all duration-200" data-aos="fade-right" data-aos-delay="100">
                <span class="mr-4 h-6 w-6">⚙️</span> Admin Panel
            </a>
            <a href="#" onclick="showSection('addProduct'); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-500 transition-all duration-200" data-aos="fade-right" data-aos-delay="150">
                <span class="mr-4 h-6 w-6">➕</span> Add Product
            </a>
            <a href="#" onclick="showSection('billing'); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-500 transition-all duration-200" data-aos="fade-right" data-aos-delay="200">
                <span class="mr-4 h-6 w-6">🛒</span> Billing
            </a>
            <a href="#" onclick="showSection('dashboard'); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-500 transition-all duration-200" data-aos="fade-right" data-aos-delay="250">
                <span class="mr-4 h-6 w-6">📊</span> Dashboard
            </a>
            <a href="#" onclick="showSection('history'); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-500 transition-all duration-200" data-aos="fade-right" data-aos-delay="300">
                <span class="mr-4 h-6 w-6">📜</span> Sales History
            </a>
            <button onclick="toggleDarkMode(); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-500 transition-all duration-200 w-full text-left" data-aos="fade-right" data-aos-delay="350">
                <span class="mr-4 h-6 w-6">🌙</span> Toggle Dark Mode
            </button>
            <button id="logoutBtn" onclick="logout(); toggleSidebar()" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-200 w-full text-left mt-4 hidden" data-aos="fade-right">
                <span class="mr-4 h-6 w-6">🚪</span> Logout
            </button>
        </nav>
    </div>

    <!-- Mobile Sidebar Toggle Button -->
    <button onclick="toggleSidebar()" class="lg:hidden fixed top-4 left-4 z-50 bg-primary-500 text-white p-2 rounded-lg shadow-lg hover:bg-primary-600 transition-all duration-200">
        <span id="sidebarIcon">☰</span>
    </button>

    <!-- Overlay for Mobile Sidebar -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden transition-opacity duration-300" onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <div class="lg:ml-64 p-4">
        <div class="bg-gradient-to-br from-green-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700 min-h-screen rounded-2xl p-6 shadow-inner">
            <!-- Login Section -->
            <section id="login" class="section active" data-aos="fade-up">
                <div class="max-w-md mx-auto bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl shadow-2xl p-8 border border-white/20 dark:border-gray-700/50 transform hover:scale-[1.02] transition-all duration-300">
                    <h2 class="text-3xl font-bold text-center mb-6 text-primary-600 flex items-center justify-center"><span class="mr-2">🔑</span> Counter Login</h2>
                    <div class="space-y-4">
                        <select id="counterSelect" class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700">
                            <option value="1">Counter 1 (PIN: 1234)</option>
                            <option value="2">Counter 2 (PIN: 5678)</option>
                            <option value="3">Counter 3 (PIN: 9012)</option>
                            <option value="4">Counter 4 (PIN: 3456)</option>
                        </select>
                        <input type="password" id="counterPin" class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700" placeholder="Enter PIN">
                        <button onclick="counterLogin()" class="w-full bg-gradient-to-r from-primary-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg hover:from-primary-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg">Enter Shop</button>
                    </div>
                    <p id="loginMsg" class="mt-4 text-center text-sm font-medium"></p>
                </div>
            </section>

            <!-- Admin Login Section -->
            <section id="adminLogin" class="section hidden" data-aos="zoom-in">
                <div class="max-w-md mx-auto bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl shadow-2xl p-8 border border-white/20 dark:border-gray-700/50 transform hover:scale-[1.02] transition-all duration-300">
                    <h2 class="text-3xl font-bold text-center mb-6 text-blue-600 flex items-center justify-center"><span class="mr-2">🛡️</span> Admin Access</h2>
                    <div class="space-y-4">
                        <input type="email" id="adminEmail" class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-blue-500/20 bg-white dark:bg-gray-700" placeholder="Email (admin@shop.com)" value="admin@shop.com">
                        <input type="password" id="adminPass" class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-blue-500/20 bg-white dark:bg-gray-700" placeholder="Password (admin123)">
                        <button onclick="adminLogin()" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 shadow-lg">Secure Login</button>
                    </div>
                    <p id="adminMsg" class="mt-4 text-center text-sm font-medium"></p>
                </div>
            </section>

            <!-- Admin Panel Section -->
            <section id="admin" class="section hidden" data-aos="fade-up">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl shadow-xl p-6 border border-white/20 dark:border-gray-700/50">
                            <h3 class="text-2xl font-bold mb-4 flex items-center text-primary-600"><span class="mr-2">📦</span> Products Management</h3>
                            <input type="text" id="searchProducts" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg mb-4 focus:ring-2 focus:ring-primary-500" placeholder="Search products..." onkeyup="searchProducts()">
                            <div class="overflow-x-auto">
                                <table class="w-full table-auto">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="p-3 text-left font-semibold">Name</th>
                                            <th class="p-3 text-left font-semibold">Qty</th>
                                            <th class="p-3 text-left font-semibold">Purchase Cost</th>
                                            <th class="p-3 text-left font-semibold">Selling Price</th>
                                            <th class="p-3 text-left font-semibold">Stock %</th>
                                            <th class="p-3 text-left font-semibold">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productsList" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                                </table>
                            </div>
                            <div class="mt-4 flex space-x-2">
                                <input type="file" id="csvFile" accept=".csv" class="hidden" onchange="uploadCSV()">
                                <button onclick="document.getElementById('csvFile').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all duration-200">Bulk Import CSV</button>
                                <button onclick="exportProductsCSV()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all duration-200">Export CSV</button>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl shadow-xl p-6 border border-white/20 dark:border-gray-700/50">
                            <h3 class="text-xl font-bold mb-4 flex items-center text-red-500"><span class="mr-2">🔔</span> Low Stock Alerts</h3>
                            <ul id="lowStockList" class="space-y-2"></ul>
                        </div>
                        <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl shadow-xl p-6 border border-white/20 dark:border-gray-700/50">
                            <h3 class="text-xl font-bold mb-4 flex items-center text-gray-600"><span class="mr-2">👥</span> Manage Counters</h3>
                            <p class="text-sm">PINs editable in Firebase. Current: 1-1234, 2-5678, 3-9012, 4-3456.</p>
                        </div>
                    </div>
                </div>
                <p id="adminMsg" class="mt-4 text-center text-sm font-medium"></p>
            </section>

            <!-- Add Product Section -->
            <section id="addProduct" class="section hidden" data-aos="slide-right">
                <div class="max-w-2xl mx-auto bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl shadow-2xl p-8 border border-white/20 dark:border-gray-700/50">
                    <h2 class="text-3xl font-bold mb-6 text-primary-600 flex items-center justify-center"><span class="mr-2">➕</span> Add/Edit Product</h2>
                    <form id="productForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="productName" class="p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700" placeholder="Product Name" required>
                            <input type="text" id="category" class="p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700" placeholder="Category (e.g., Electronics)">
                            <input type="date" id="expiryDate" class="p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700">
                            <input type="number" id="purchaseCost" class="p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700" placeholder="Purchase Cost ($)" step="0.01" required>
                            <input type="number" id="marketPrice" class="p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700" placeholder="Market Price ($)" step="0.01" required>
                            <input type="number" id="sellingPrice" class="p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700" placeholder="Selling Price ($)" step="0.01" required>
                            <input type="number" id="quantity" class="p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-4 focus:ring-primary-500/20 bg-white dark:bg-gray-700" placeholder="Initial Quantity" required>
                        </div>
                        <input type="hidden" id="productId">
                        <button type="submit" class="w-full bg-gradient-to-r from-primary-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg hover:from-primary-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg">Save &
